<!DOCTYPE html>
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<!-- Bootstrap Stuff -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
    crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp"
    crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
    crossorigin="anonymous"></script>

<!-- End Bootstrap stuff -->

        <link rel="STYLESHEET" type="text/css" href="main.css">

<html>

<head>
    <!-- Firebase stuff -->
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.6.2/firebase-messaging.js"></script>
    <script>
        // Initialize Firebase
        var config =
            {
                apiKey: "AIzaSyDqs1V4sQgKsXXe071909_aO_SLy5P7bpE",
                authDomain: "newsapp-5d5a8.firebaseapp.com",
                databaseURL: "https://newsapp-5d5a8.firebaseio.com",
                projectId: "newsapp-5d5a8",
                storageBucket: "newsapp-5d5a8.appspot.com",
                messagingSenderId: "536892297743"
            };

        firebase.initializeApp(config);
    </script>
    <!-- End Firebase stuff -->
</head>

<body>

    <nav class="navbar navbar-default">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Newsboy</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="home.html">Home</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-sm-6">
                <span id="id_mainArticleTitle" class="articleTitles"></span>
                    <br> 
                    by <span id="id_mainArticleAuthor"></span>
                <div class="well">
                    <span id="id_mainArticleLeaning"></span>
                    <br>
                    <br>
                    <span id="id_mainArticleText"></span>
                </div>
                    <button class="btn btn-info btn-md" onclick="updateThumbsUp('id_mainArticle')" id="id_mainArticleThumbsUp">
                        <span class="glyphicon glyphicon-thumbs-up"></span>
                    </button>
                <span id="id_mainArticleRatingUp"></span>
                    <button class="btn btn-danger btn-md" onclick="updateThumbsDown('id_mainArticle')" id="id_mainArticleThumbsDown">
                            <span class="glyphicon glyphicon-thumbs-down"></span>
                    </button>
                    <span id="id_mainArticleRatingDown"></span>
                <div>
                    
                    <br>
                    <div id="id_origSlideCtnr">
                        <input type="range" min="1" max="5" value="3" class="slider" id="id_origLeaning">,
                        <br>
                        <span id="id_mainLeaningOutput">Center</span>
                        <br>
                        <button type="button" class="btn btn-primary" id="id_mainArticleLeaningButton" onclick="click_updateLeaning('main')">Submit Leaning</button>
                    </div>
                </div>
            </div>
            <div class="col-sm-6">
                <span id="id_compArticleTitle" class="articleTitles"></span>
                <div class="well">
                    <br> AUTHOR: <span id="id_compArticleAuthor"></span>
                    <br>
                    <span>Users that liked this article: </span><span id="id_compArticleRatingUp"></span>
                    <span>Users that disliked this article: </span><span id="id_compArticleRatingDown"></span>
                    <br>
                    <span id="id_compArticleLeaing"></span>
                    <br>
                    <br>
                    <span id="id_compArticleText"></span></div>
                <div>
                    <button class="btn btn-info btn-md" onclick="updateThumbsUp('id_compArticle')" id="id_compArticleThumbsUp">
                                <span class="glyphicon glyphicon-thumbs-up"></span></button>
                    <button class="btn btn-danger btn-md" onclick="updateThumbsDown('id_compArticle')" id="id_compArticleThumbsDown">
                                    <span class="glyphicon glyphicon-thumbs-down"></span></button>
                    <div id="id_refSlideCtnr">
                        <input type="range" min="1" max="5" value="3" class="slider" id="id_refLeaning">
                        <span id="id_compLeaningOutput">Center</span>
                        <button type="button" class="btn btn-primary" id="id_compArticleLeaningButton" onclick="click_updateLeaning('comp')">Submit Leaning</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>

<script>
        var valueFromHome = localStorage.getItem("Hello");

        // Perform these functions once the DOM has been loaded.
        $(document).ready(function () {
            setValueFromKeysWithID("Articles/aa2", "Title", "id_mainArticleTitle");
            setValueFromKeysWithID("Articles/aa2", "Author", "id_mainArticleAuthor");
            setValueFromKeysWithID("Articles/aa2", "Text", "id_mainArticleText");

            setValueFromKeysWithID("Articles/aa2/Rating", "Thumbs Up", "id_mainArticleRatingUp");
            setValueFromKeysWithID("Articles/aa2/Rating", "Thumbs Down", "id_mainArticleRatingDown");

            setValueFromKeysWithID("Articles/aa1", "Title", "id_compArticleTitle");
            setValueFromKeysWithID("Articles/aa1", "Author", "id_compArticleAuthor");
            setValueFromKeysWithID("Articles/aa1", "Text", "id_compArticleText");

            setValueFromKeysWithID("Articles/aa1/Rating", "Thumbs Up", "id_compArticleRatingUp");
            setValueFromKeysWithID("Articles/aa1/Rating", "Thumbs Down", "id_compArticleRatingDown");
        });

        // TODO
        // Condense these two functions into one

        var originalSlider = document.getElementById("id_origLeaning");
        var comparisonSlider = document.getElementById("id_refLeaning");

        originalSlider.oninput = function () {
            var textReplacement;

            if (this.value == 1) {
                textReplacement = "Left";
            }
            else if (this.value == 2) {
                textReplacement = "Center Left";
            }
            else if (this.value == 3) {
                textReplacement = "Center";
            }
            else if (this.value == 4) {
                textReplacement = "Center Right";
            }
            else {
                textReplacement = "Right";
            }

            $("#id_mainLeaningOutput").text(textReplacement);
        }

        comparisonSlider.oninput = function () {
            var textReplacement;

            if (this.value == 1) {
                textReplacement = "Left";
            }
            else if (this.value == 2) {
                textReplacement = "Center Left";
            }
            else if (this.value == 3) {
                textReplacement = "Center";
            }
            else if (this.value == 4) {
                textReplacement = "Center Right";
            }
            else {
                textReplacement = "Right";
            }

            $("#id_compLeaningOutput").text(textReplacement);
        }

        function getValuesFromKeys(parentPath, childPath) {
            var defer = $.Deferred();

            var ref = firebase.database().ref(parentPath);

            ref.once('value', function (snapshot) {
                var value = snapshot.child(childPath).val();

                defer.resolve(value);
            });

            return defer.promise();
        }

        function setValueFromKeysWithID(parentPath, childPath, domID) {
            getValuesFromKeys(parentPath, childPath).then(function (valueRetrieved) { $("#" + domID).html(valueRetrieved); });
        }

        // TODO
        // Condense
        // TODO
        // Remove hard coded paths
        function updateThumbsUp(buttonID) {
            incrementSpecificPath("Articles/aa2/Rating", "Thumbs Up");
            var button = "#" + buttonID + "ThumbsUp";
            var accompanyButton = "#" + buttonID + "ThumbsDown";
            disableButton(button);
            disableButton(accompanyButton);
        }

        function updateThumbsDown(buttonID) {
            incrementSpecificPath("Articles/aa2/Rating", "Thumbs Down");
            var button = "#" + buttonID + "ThumbsDown";
            var accompanyButton = "#" + buttonID + "ThumbsUp";
            disableButton(button);
            disableButton(accompanyButton);
        }

        function disableButton(buttonID) {
            $(buttonID).addClass('disabled'); // Disables visually
            $(buttonID).prop('disabled', true); // Disables visually + functionally
        }

        function click_updateLeaning(buttonID) {
            var stringReplace = "#id_" + buttonID + "LeaningOutput";
            var leaningText = $(stringReplace).html();
            incrementSpecificPath("Articles/aa2/Political Leaning", leaningText);
            var button = "#id_" + buttonID + "ArticleLeaningButton";
            disableButton(button);

            // TODO
            // Disable the slider
            //var slider = "#id_refLeaning";
            //disableButton(slider);
        }

        function incrementSpecificPath(parentPath, childName) {
            var ref = firebase.database().ref(parentPath);

            ref.once("value").then(function (snapshot) {
                var val = snapshot.child(childName).val() + 1;
                var specificRef = firebase.database().ref(parentPath + "/" + childName);
                specificRef.set(val);
            });
        }

</script>